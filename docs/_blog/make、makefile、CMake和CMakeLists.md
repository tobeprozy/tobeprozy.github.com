---
title: makeå’Œmakefile
article: true
date: 2023-04-22
category:
  - linux
tag:
  - cmake
  - make
order: 
icon: ğŸ“…
---

makeã€makefileã€CMakeå’ŒCMakeLists.txtæ˜¯æ„å»ºè½¯ä»¶çš„å·¥å…·å’Œè„šæœ¬ã€‚å®ƒä»¬çš„é«˜é¢‘ç”¨æ³•å¦‚ä¸‹ï¼š

-   makeï¼šæ˜¯ä¸€ä¸ªç”¨äºè‡ªåŠ¨åŒ–ç¼–è¯‘ç¨‹åºçš„å·¥å…·ã€‚Makeå·¥å…·é€šè¿‡è¯»å–Makefileæ–‡ä»¶æ¥ç¡®å®šå¦‚ä½•ç¼–è¯‘å’Œé“¾æ¥ç¨‹åºã€‚Makefileæ–‡ä»¶ä¸­åŒ…å«äº†ç¼–è¯‘å’Œé“¾æ¥çš„è§„åˆ™ï¼Œä»¥åŠä¾èµ–å…³ç³»å’Œå‘½ä»¤è¡ŒæŒ‡ä»¤ã€‚Makeå·¥å…·å¯ä»¥æ ¹æ®Makefileæ–‡ä»¶è‡ªåŠ¨åŒ–åœ°æ‰§è¡Œç¼–è¯‘å’Œé“¾æ¥ç¨‹åºçš„è¿‡ç¨‹ã€‚
    
-   makefileï¼šæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†Makeå·¥å…·æ‰€éœ€çš„è§„åˆ™å’ŒæŒ‡ä»¤ï¼Œä»¥å‘Šè¯‰Makeå·¥å…·å¦‚ä½•ç¼–è¯‘å’Œé“¾æ¥ç¨‹åºã€‚Makefileæ–‡ä»¶é€šå¸¸åŒ…æ‹¬ç›®æ ‡ã€ä¾èµ–å…³ç³»å’Œå‘½ä»¤è¡ŒæŒ‡ä»¤ã€‚
    
-   CMakeï¼šæ˜¯ä¸€ä¸ªè·¨å¹³å°çš„æ„å»ºç³»ç»Ÿç”Ÿæˆå™¨ï¼Œå®ƒå¯ä»¥ç”Ÿæˆå„ç§ä¸åŒå¹³å°çš„æ„å»ºç³»ç»Ÿï¼Œå¦‚Unix Makefileã€Visual Studioå·¥ç¨‹ã€Xcodeå·¥ç¨‹ç­‰ã€‚CMakeä½¿ç”¨CMakeLists.txtæ–‡ä»¶æ¥æè¿°é¡¹ç›®çš„æ„å»ºè¿‡ç¨‹ï¼Œå¹¶ç”Ÿæˆé€‚ç”¨äºæ‰€é€‰å¹³å°çš„æ„å»ºç³»ç»Ÿã€‚
    
-   CMakeLists.txtï¼šæ˜¯ä¸€ä¸ªCMakeçš„é…ç½®æ–‡ä»¶ï¼Œå®ƒæè¿°äº†é¡¹ç›®çš„å„ä¸ªç»„æˆéƒ¨åˆ†åŠå…¶ä¾èµ–å…³ç³»ï¼Œå¹¶ä¸ºæ¯ä¸ªç»„æˆéƒ¨åˆ†æŒ‡å®šå¦‚ä½•ç¼–è¯‘å’Œé“¾æ¥ã€‚CMakeLists.txtæ–‡ä»¶ç”±CMakeå·¥å…·è¯»å–å¹¶ç”Ÿæˆé€‚ç”¨äºç›®æ ‡å¹³å°çš„æ„å»ºç³»ç»Ÿã€‚
    

è¿™äº›å·¥å…·ä¹‹é—´çš„è”ç³»å’ŒåŒºåˆ«å¦‚ä¸‹ï¼š

-   makeå’Œmakefileæ˜¯ä¸€ç»„å·¥å…·å’Œè„šæœ¬ï¼Œç”¨äºè‡ªåŠ¨åŒ–ç¼–è¯‘å’Œé“¾æ¥ç¨‹åºã€‚Makeå·¥å…·é€šè¿‡è¯»å–Makefileæ–‡ä»¶æ¥ç¡®å®šç¼–è¯‘å’Œé“¾æ¥çš„è§„åˆ™å’Œä¾èµ–å…³ç³»ã€‚
    
-   CMakeå’ŒCMakeLists.txtæ˜¯å¦ä¸€ç»„å·¥å…·å’Œè„šæœ¬ï¼Œç”¨äºè‡ªåŠ¨ç”Ÿæˆé€‚ç”¨äºç›®æ ‡å¹³å°çš„æ„å»ºç³»ç»Ÿã€‚CMakeå·¥å…·é€šè¿‡è¯»å–CMakeLists.txtæ–‡ä»¶æ¥ç¡®å®šé¡¹ç›®çš„æ„å»ºè¿‡ç¨‹å’Œä¾èµ–å…³ç³»ï¼Œå¹¶ç”Ÿæˆé€‚ç”¨äºç›®æ ‡å¹³å°çš„æ„å»ºç³»ç»Ÿã€‚
    
-   makeå’Œmakefileé€šå¸¸ç”¨äºUnixå’Œç±»Unixç³»ç»Ÿï¼Œè€ŒCMakeå’ŒCMakeLists.txtåˆ™æ˜¯è·¨å¹³å°çš„æ„å»ºç³»ç»Ÿç”Ÿæˆå™¨ã€‚
    
-   makefileå’ŒCMakeLists.txtå…·æœ‰ç›¸ä¼¼çš„ç»“æ„ï¼Œéƒ½åŒ…å«äº†ç›®æ ‡ã€ä¾èµ–å…³ç³»å’Œå‘½ä»¤è¡ŒæŒ‡ä»¤ã€‚ä½†æ˜¯ï¼ŒCMakeLists.txtæ–‡ä»¶å…·æœ‰æ›´é«˜çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†ç°ä»£çš„CMakeè¯­è¨€æ¥æè¿°é¡¹ç›®çš„æ„å»ºè¿‡ç¨‹ã€‚
# makeå’Œmakefile
`make`Â æ˜¯ä¸€ä¸ªç”¨äºè‡ªåŠ¨åŒ–ç¼–è¯‘å’Œæ„å»ºç¨‹åºçš„å·¥å…·ï¼Œå®ƒé€šè¿‡è¯»å–Â `Makefile`Â æ–‡ä»¶æ¥æ‰§è¡Œä¸€ç³»åˆ—çš„ä»»åŠ¡ã€‚`Makefile`Â æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«äº†æ„å»ºå’Œç¼–è¯‘ç¨‹åºæ‰€éœ€çš„è§„åˆ™å’Œä¾èµ–ã€‚

**makeå¸¸ç”¨å‘½ä»¤ï¼š**

-   make [target]: ç”Ÿæˆç›®æ ‡æ–‡ä»¶
-   make clean: æ¸…é™¤æ‰€æœ‰ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶å’Œä¸­é—´æ–‡ä»¶
-   make install: å®‰è£…ç¨‹åº
-   make uninstall: å¸è½½ç¨‹åº
-   make help: æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
-   make -n [target]: æ‰“å°æ‰§è¡Œç”Ÿæˆç›®æ ‡çš„å‘½ä»¤ï¼Œä½†ä¸å®é™…æ‰§è¡Œ
-   make -j [N]: åŒæ—¶è¿è¡ŒNä¸ªä»»åŠ¡è¿›è¡Œç¼–è¯‘
-   make -C [directory]: åœ¨æŒ‡å®šç›®å½•ä¸‹æ‰§è¡Œmakeå‘½ä»¤
-   make -f [makefile]: ä½¿ç”¨æŒ‡å®šçš„makefileæ–‡ä»¶è¿›è¡Œç¼–è¯‘

**Makefile è¯­æ³•å’Œæ ¼å¼ï¼š**

1.  è§„åˆ™ï¼ˆRuleï¼‰ï¼šè§„åˆ™æ˜¯ Makefile çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œå®ƒæè¿°äº†å¦‚ä½•ä»æºæ–‡ä»¶ç”Ÿæˆç›®æ ‡æ–‡ä»¶ã€‚è§„åˆ™çš„åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š
    
    ````
    target: prerequisites
        recipe
    ```
    
    å…¶ä¸­ï¼Œ`target` æ˜¯ä¸€ä¸ªæ–‡ä»¶åï¼Œè¡¨ç¤ºç›®æ ‡æ–‡ä»¶ï¼›`prerequisites` æ˜¯ä¸€ä¸ªæ–‡ä»¶ååˆ—è¡¨ï¼Œè¡¨ç¤ºç›®æ ‡æ–‡ä»¶æ‰€ä¾èµ–çš„æ–‡ä»¶ï¼›`recipe` æ˜¯ä¸€ç³»åˆ—å‘½ä»¤ï¼Œç”¨äºç”Ÿæˆç›®æ ‡æ–‡ä»¶ã€‚
    
    ````
    
2.  å˜é‡ï¼ˆVariableï¼‰ï¼šå˜é‡ç”¨äºå­˜å‚¨å€¼ï¼Œå¯ä»¥åœ¨ Makefile ä¸­é‡å¤ä½¿ç”¨ã€‚å˜é‡çš„å®šä¹‰æ ¼å¼å¦‚ä¸‹ï¼š
```
VARIABLE_NAME = value
```
åœ¨ Makefile ä¸­ä½¿ç”¨å˜é‡ï¼Œå¯ä»¥é€šè¿‡ `$(VARIABLE_NAME)` æˆ– `${VARIABLE_NAME}` çš„å½¢å¼å¼•ç”¨ã€‚

3.  æ³¨é‡Šï¼šä»¥Â `#`Â å¼€å¤´çš„è¡Œæ˜¯æ³¨é‡Šã€‚
    
4.  è‡ªåŠ¨å˜é‡ï¼šMakefile ä¸­æœ‰ä¸€äº›é¢„å®šä¹‰çš„è‡ªåŠ¨å˜é‡ï¼Œå¦‚Â `$@`ï¼ˆè¡¨ç¤ºç›®æ ‡æ–‡ä»¶åï¼‰å’ŒÂ `$^`ï¼ˆè¡¨ç¤ºæ‰€æœ‰çš„ä¾èµ–æ–‡ä»¶åˆ—è¡¨ï¼‰ç­‰ã€‚
    
5.  æ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯ï¼šMakefile æ”¯æŒÂ `ifeq`ã€`else`ã€`endif`Â ç­‰æ¡ä»¶åˆ¤æ–­è¯­å¥ï¼Œä¹Ÿæ”¯æŒÂ `foreach`Â å¾ªç¯ã€‚    

**Makefile ç¤ºä¾‹ï¼š**

```
CC = gcc
CFLAGS = -Wall -g

all: main

main: main.o utils.o
    $(CC) $(CFLAGS) -o main main.o utils.o

main.o: main.c utils.h
    $(CC) $(CFLAGS) -c main.c

utils.o: utils.c utils.h
    $(CC) $(CFLAGS) -c utils.c

clean:
    rm -f *.o main
```
ç¤ºä¾‹2ï¼š
![](./photo/22.png)


**å­¦ä¹ èµ„æºï¼š**

1.  GNU Make æ‰‹å†Œï¼š[https://www.gnu.org/software/make/manual/make.html](https://www.gnu.org/software/make/manual/make.html)
2. [[æ•™ç¨‹]Makefileçš„å†™æ³•_å“”å“©å“”å“©_bilibili](https://www.bilibili.com/video/BV1Mx411m7fm/?spm_id_from=333.788.recommend_more_video.-1&vd_source=573d3533e2a2018c9ca15d8fbdb178ad)

# CMakeå’ŒCMakeLists.txt

## cmake
1.  cmake [path-to-source]: ç”Ÿæˆæ„å»ºç³»ç»Ÿï¼Œè·¯å¾„ä¸ºæºä»£ç è·¯å¾„ã€‚
2.  cmake --build [path-to-binary]: æ„å»ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œè·¯å¾„ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶è·¯å¾„ã€‚
3.  cmake --build [path-to-binary] --target [target-name]: ç”ŸæˆæŒ‡å®šç›®æ ‡çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚
4.  cmake --install [path-to-binary] --prefix [prefix-path]: å°†å¯æ‰§è¡Œæ–‡ä»¶å®‰è£…åˆ°æŒ‡å®šè·¯å¾„ä¸‹ã€‚
5.  cmake --build [path-to-binary] --clean-first: æ¸…é™¤ä¸Šæ¬¡ç”Ÿæˆçš„ä¸­é—´æ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶ï¼Œç„¶åé‡æ–°ç”Ÿæˆã€‚
6.  cmake --build [path-to-binary] --config [config-name]: æŒ‡å®šç¼–è¯‘é…ç½®ï¼Œå¦‚Debugã€Releaseã€MinSizeRelå’ŒRelWithDebInfoã€‚
7.  cmake --build [path-to-binary] -- -j [N]: æŒ‡å®šå¹¶å‘ç¼–è¯‘çº¿ç¨‹æ•°é‡ã€‚
8.  cmake --build [path-to-binary] --target clean: æ¸…é™¤æ‰€æœ‰ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶å’Œä¸­é—´æ–‡ä»¶ã€‚
9.  cmake --version: æ˜¾ç¤ºCMakeç‰ˆæœ¬ä¿¡æ¯ã€‚

## CMakefile.txt
CMakeLists.txtæ˜¯CMakeçš„é…ç½®æ–‡ä»¶ï¼Œç”¨äºæè¿°é¡¹ç›®çš„æ„å»ºè¿‡ç¨‹å’Œä¾èµ–å…³ç³»ï¼Œå¹¶ä¸ºæ¯ä¸ªç»„æˆéƒ¨åˆ†æŒ‡å®šå¦‚ä½•ç¼–è¯‘å’Œé“¾æ¥ã€‚ä»¥ä¸‹æ˜¯CMakeLists.txtå¸¸ç”¨çš„é…ç½®ï¼š

1.  cmake_minimum_required(VERSION version_number): æŒ‡å®šéœ€è¦çš„CMakeç‰ˆæœ¬ã€‚
2.  project(project_name): æŒ‡å®šé¡¹ç›®åç§°ã€‚
3.  add_executable(executable_name source_files): æ·»åŠ å¯æ‰§è¡Œæ–‡ä»¶ï¼Œsource_filesä¸ºæºæ–‡ä»¶åˆ—è¡¨ã€‚
4.  add_library(library_name source_files): æ·»åŠ åº“æ–‡ä»¶ï¼Œsource_filesä¸ºæºæ–‡ä»¶åˆ—è¡¨ã€‚
5.  target_link_libraries(target_name library_name): ä¸ºç›®æ ‡æ–‡ä»¶æ·»åŠ é“¾æ¥åº“ã€‚
6.  include_directories(directory): æ·»åŠ å¤´æ–‡ä»¶è·¯å¾„ã€‚
7.  link_directories(directory): æ·»åŠ åº“æ–‡ä»¶è·¯å¾„ã€‚
8.  add_definitions(-Dmacro): æ·»åŠ å®å®šä¹‰ã€‚
9.  set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11"): è®¾ç½®ç¼–è¯‘é€‰é¡¹ï¼Œå¦‚ç¼–è¯‘æ ‡å‡†ã€‚
10.  add_subdirectory(directory): æ·»åŠ å­ç›®å½•ï¼Œä½¿å¾—CMakeå¯ä»¥é€’å½’ç¼–è¯‘å­ç›®å½•ä¸­çš„ä»£ç ã€‚